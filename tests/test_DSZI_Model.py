from numpy.testing import assert_allclose, assert_almost_equal

from reliability.Distributions import DSZI_Model, Lognormal_Distribution
from reliability.Probability_plotting import plot_points

atol = 1e-8
rtol = 1e-7

def test_dszi():
    dist = DSZI_Model(distribution = Lognormal_Distribution(mu=2,sigma=0.5), DS= 0.75)
    failures, right_censored = dist.random_samples(50,seed=7, right_censored_time = 50)
    pdf = dist.PDF()
    sf = dist.SF()
    hf = dist.HF()
    chf = dist.CHF()
    quantile = dist.quantile(.2)
    inverse_sf = dist.inverse_SF(.2)
    plot_points(failures = failures, right_censored = right_censored, func="SF")
    assert_allclose(dist.mean, 8.372897488127265, rtol=rtol, atol=atol)
    assert_allclose(dist.median, 7.38905609893065, rtol=rtol, atol=atol)
    assert_allclose(dist.mode, 5.754602676005731, rtol=rtol, atol=atol)
    assert_allclose(dist.standard_deviation, 4.462254918069333, rtol=rtol, atol=atol)
    assert_allclose(dist.variance, 19.911718953833947, rtol=rtol, atol=atol)
    assert_allclose(dist.skewness, 1.7501896550697178, rtol=rtol, atol=atol)
    assert_allclose(dist.kurtosis, 8.898445673784778, rtol=rtol, atol=atol)
    assert_allclose(inverse_sf, 177.80197746150802, rtol=rtol, atol=atol)
    assert_allclose(quantile, 5.411476365129845, rtol=rtol, atol=atol)
    assert_almost_equal(chf,[-0.00000000e+00,  7.50028126e-05,  1.71289930e-04,  3.47983996e-04,        6.44134176e-04,  1.10571833e-03,  1.78380044e-03,  2.73238440e-03,        4.00622737e-03,  5.65881462e-03,  7.74062736e-03,  1.02977712e-02,        1.33709818e-02,  1.69949887e-02,  2.11981948e-02,  2.60026201e-02,        3.14240527e-02,  3.74723552e-02,  4.41518783e-02,  5.14619427e-02,        5.93973554e-02,  6.79489368e-02,  7.71040388e-02,  8.68470403e-02,        9.71598131e-02,  1.08022150e-01,  1.19412155e-01,  1.31306596e-01,        1.43681211e-01,  1.56510991e-01,  1.69770413e-01,  1.83433656e-01,        1.97474774e-01,  2.11867853e-01,  2.26587143e-01,  2.41607168e-01,        2.56902815e-01,  2.72449414e-01,  2.88222801e-01,  3.04199366e-01,        3.20356096e-01,  3.36670610e-01,  3.53121179e-01,  3.69686747e-01,        3.86346944e-01,  4.03082094e-01,  4.19873222e-01,  4.36702053e-01,        4.53551014e-01,  4.70403228e-01,  4.87242511e-01,  5.04053366e-01,        5.20820973e-01,  5.37531183e-01,  5.54170508e-01,  5.70726111e-01,        5.87185793e-01,  6.03537986e-01,  6.19771739e-01,  6.35876704e-01,        6.51843131e-01,  6.67661847e-01,  6.83324250e-01,  6.98822294e-01,        7.14148475e-01,  7.29295820e-01,  7.44257874e-01,  7.59028685e-01,        7.73602789e-01,  7.87975204e-01,  8.02141406e-01,  8.16097325e-01,        8.29839323e-01,  8.43364186e-01,  8.56669107e-01,  8.69751674e-01,        8.82609852e-01,  8.95241974e-01,  9.07646725e-01,  9.19823123e-01,        9.31770515e-01,  9.43488552e-01,  9.54977184e-01,  9.66236641e-01,        9.77267419e-01,  9.88070269e-01,  9.98646183e-01,  1.00899638e+00,        1.01912229e+00,  1.02902555e+00,  1.03870798e+00,  1.04817157e+00,        1.05741850e+00,  1.06645106e+00,  1.07527172e+00,  1.08388305e+00,        1.09228776e+00,  1.10048865e+00,  1.10848863e+00,  1.11629069e+00,        1.12389790e+00,  1.13131340e+00,  1.13854040e+00,  1.14558213e+00,        1.15244190e+00,  1.15912304e+00,  1.16562890e+00,  1.17196286e+00,        1.17812833e+00,  1.18412871e+00,  1.18996741e+00,  1.19564782e+00,        1.20117336e+00,  1.20654742e+00,  1.21177335e+00,  1.21685451e+00,        1.22179423e+00,  1.22659580e+00,  1.23126250e+00,  1.23579755e+00,        1.24020414e+00,  1.24448544e+00,  1.24864455e+00,  1.25268455e+00,        1.25660846e+00,  1.26041925e+00,  1.26411986e+00,  1.26771316e+00,        1.27120197e+00,  1.27458909e+00,  1.27787722e+00,  1.28106905e+00,        1.28416718e+00,  1.28717418e+00,  1.29009256e+00,  1.29292478e+00,        1.29567323e+00,  1.29834027e+00,  1.30092819e+00,  1.30343923e+00,        1.30587557e+00,  1.30823937e+00,  1.31053269e+00,  1.31275757e+00,        1.31491600e+00,  1.31700990e+00,  1.31904117e+00,  1.32101162e+00,        1.32292305e+00,  1.32477720e+00,  1.32657575e+00,  1.32832036e+00,        1.33001263e+00,  1.33165411e+00,  1.33324633e+00,  1.33479075e+00,        1.33628881e+00,  1.33774190e+00,  1.33915137e+00,  1.34051853e+00,        1.34184467e+00,  1.34313103e+00,  1.34437879e+00,  1.34558915e+00,        1.34676322e+00,  1.34790212e+00,  1.34900691e+00,  1.35007862e+00,        1.35111828e+00,  1.35212684e+00,  1.35310527e+00,  1.35405448e+00,        1.35497535e+00,  1.35586877e+00,  1.35673556e+00,  1.35673556e+00,        1.36095592e+00,  1.36464566e+00,  1.36785902e+00,  1.37064686e+00,        1.37305642e+00,  1.37513129e+00,  1.37691140e+00,  1.37843306e+00,        1.37972912e+00,  1.38082909e+00,  1.38175931e+00,  1.38254323e+00,        1.38320153e+00,  1.38375244e+00,  1.38421186e+00,  1.38459369e+00,        1.38490992e+00,  1.38517094e+00,  1.38538565e+00,  1.38556166e+00,        1.38570547e+00,  1.38582255e+00,  1.38591757e+00,  1.38599441e+00])
    assert_almost_equal(pdf,[0.00000000e+00, 5.15946752e-04, 1.00450150e-03, 1.76273412e-03,       2.84919927e-03, 4.30974499e-03, 6.17382863e-03, 8.45302776e-03,       1.11414000e-02, 1.42171991e-02, 1.76454433e-02, 2.13808994e-02,       2.53711405e-02, 2.95594372e-02, 3.38873305e-02, 3.82968066e-02,       4.27320468e-02, 4.71407627e-02, 5.14751499e-02, 5.56925071e-02,       5.97555725e-02, 6.36326286e-02, 6.72974260e-02, 7.07289686e-02,       7.39112002e-02, 7.68326241e-02, 7.94858818e-02, 8.18673127e-02,       8.39765118e-02, 8.58158965e-02, 8.73902928e-02, 8.87065465e-02,       8.97731642e-02, 9.05999852e-02, 9.11978860e-02, 9.15785165e-02,       9.17540684e-02, 9.17370717e-02, 9.15402199e-02, 9.11762205e-02,       9.06576690e-02, 8.99969437e-02, 8.92061199e-02, 8.82969008e-02,       8.72805631e-02, 8.61679160e-02, 8.49692710e-02, 8.36944221e-02,       8.23526336e-02, 8.09526355e-02, 7.95026246e-02, 7.80102705e-02,       7.64827255e-02, 7.49266380e-02, 7.33481683e-02, 7.17530063e-02,       7.01463907e-02, 6.85331291e-02, 6.69176193e-02, 6.53038701e-02,       6.36955226e-02, 6.20958719e-02, 6.05078873e-02, 5.89342330e-02,       5.73772880e-02, 5.58391651e-02, 5.43217296e-02, 5.28266168e-02,       5.13552491e-02, 4.99088518e-02, 4.84884687e-02, 4.70949764e-02,       4.57290979e-02, 4.43914156e-02, 4.30823830e-02, 4.18023366e-02,       4.05515058e-02, 3.93300234e-02, 3.81379343e-02, 3.69752045e-02,       3.58417286e-02, 3.47373378e-02, 3.36618061e-02, 3.26148569e-02,       3.15961691e-02, 3.06053819e-02, 2.96421002e-02, 2.87058991e-02,       2.77963280e-02, 2.69129141e-02, 2.60551666e-02, 2.52225793e-02,       2.44146336e-02, 2.36308014e-02, 2.28705473e-02, 2.21333308e-02,       2.14186081e-02, 2.07258342e-02, 2.00544643e-02, 1.94039551e-02,       1.87737663e-02, 1.81633616e-02, 1.75722098e-02, 1.69997854e-02,       1.64455698e-02, 1.59090516e-02, 1.53897275e-02, 1.48871024e-02,       1.44006903e-02, 1.39300142e-02, 1.34746068e-02, 1.30340103e-02,       1.26077772e-02, 1.21954696e-02, 1.17966603e-02, 1.14109317e-02,       1.10378770e-02, 1.06770993e-02, 1.03282121e-02, 9.99083888e-03,       9.66461330e-03, 9.34917896e-03, 9.04418930e-03, 8.74930751e-03,       8.46420636e-03, 8.18856804e-03, 7.92208402e-03, 7.66445488e-03,       7.41539010e-03, 7.17460792e-03, 6.94183513e-03, 6.71680690e-03,       6.49926656e-03, 6.28896543e-03, 6.08566262e-03, 5.88912482e-03,       5.69912615e-03, 5.51544790e-03, 5.33787839e-03, 5.16621278e-03,       5.00025284e-03, 4.83980681e-03, 4.68468917e-03, 4.53472050e-03,       4.38972729e-03, 4.24954177e-03, 4.11400170e-03, 3.98295025e-03,       3.85623583e-03, 3.73371190e-03, 3.61523683e-03, 3.50067377e-03,       3.38989043e-03, 3.28275904e-03, 3.17915609e-03, 3.07896229e-03,       2.98206238e-03, 2.88834500e-03, 2.79770261e-03, 2.71003130e-03,       2.62523070e-03, 2.54320388e-03, 2.46385722e-03, 2.38710028e-03,       2.31284573e-03, 2.24100923e-03, 2.17150931e-03, 2.10426731e-03,       2.03920725e-03, 1.97625576e-03, 1.91534201e-03, 1.85639755e-03,       1.79935633e-03, 1.74415453e-03, 1.69073053e-03, 1.69073053e-03,       1.43257019e-03, 1.20974840e-03, 1.01815016e-03, 8.54016453e-04,       7.13934341e-04, 5.94823251e-04, 4.93918428e-04, 4.08752247e-04,       3.37134119e-04, 2.77129583e-04, 2.27039123e-04, 1.85377125e-04,       1.50851354e-04, 1.22343222e-04, 9.88890589e-05, 7.96625499e-05,       6.39584298e-05, 5.11774935e-05, 4.08129381e-05, 3.24380200e-05,       2.56949895e-05, 2.02852415e-05, 1.59606123e-05, 1.25157404e-05])
    assert_almost_equal(sf,[1.        , 0.999925  , 0.99982872, 0.99965208, 0.99935607,       0.99889489, 0.99821779, 0.99727135, 0.99600179, 0.99435717,       0.99228925, 0.98975507, 0.98671801, 0.98314861, 0.97902491,       0.97433254, 0.96906455, 0.96322105, 0.95680863, 0.9498398 ,       0.94233225, 0.93430818, 0.92579353, 0.91681732, 0.90741098,       0.89760771, 0.88744196, 0.87694886, 0.86616383, 0.85512212,       0.84385853, 0.8324071 , 0.82080085, 0.80907161, 0.79724986,       0.78536463, 0.77344338, 0.76151195, 0.74959456, 0.73771378,       0.7258905 , 0.71414403, 0.70249206, 0.69095074, 0.67953472,       0.66825724, 0.65713012, 0.64616393, 0.63536794, 0.6247503 ,       0.61431804, 0.60407714, 0.59403266, 0.58418873, 0.57454865,       0.56511495, 0.55588947, 0.54687338, 0.53806724, 0.5294711 ,       0.52108446, 0.51290643, 0.50493567, 0.49717048, 0.48960885,       0.48224846, 0.47508674, 0.4681209 , 0.46134793, 0.45476467,       0.4483678 , 0.44215387, 0.43611936, 0.43026061, 0.42457394,       0.4190556 , 0.4137018 , 0.40850874, 0.40347259, 0.39858954,       0.39385577, 0.38926748, 0.38482092, 0.38051235, 0.37633807,       0.37229443, 0.36837782, 0.3645847 , 0.36091158, 0.35735502,       0.35391165, 0.35057817, 0.34735134, 0.344228  , 0.34120503,       0.33827942, 0.33544819, 0.33270847, 0.33005742, 0.32749232,       0.32501046, 0.32260926, 0.32028617, 0.31803872, 0.31586452,       0.31376122, 0.31172656, 0.30975833, 0.3078544 , 0.30601269,       0.30423118, 0.30250792, 0.30084101, 0.29922861, 0.29766894,       0.29616027, 0.29470093, 0.29328929, 0.29192379, 0.2906029 ,       0.28932515, 0.28808911, 0.2868934 , 0.28573669, 0.28461768,       0.28353513, 0.28248782, 0.28147458, 0.28049427, 0.27954581,       0.27862814, 0.27774022, 0.27688108, 0.27604975, 0.2752453 ,       0.27446685, 0.27371353, 0.2729845 , 0.27227895, 0.2715961 ,       0.27093521, 0.27029553, 0.26967636, 0.26907703, 0.26849688,       0.26793526, 0.26739156, 0.2668652 , 0.26635559, 0.26586219,       0.26538445, 0.26492186, 0.26447392, 0.26404015, 0.26362007,       0.26321325, 0.26281923, 0.26243761, 0.26206797, 0.26170993,       0.26136309, 0.26102711, 0.26070161, 0.26038626, 0.26008072,       0.25978469, 0.25949784, 0.25921988, 0.25895052, 0.25868948,       0.2584365 , 0.2581913 , 0.25795365, 0.2577233 , 0.2575    ,       0.2575    , 0.25641555, 0.25547118, 0.25465158, 0.25394264,       0.25333149, 0.2528064 , 0.25235678, 0.25197307, 0.25164671,       0.25137006, 0.25113634, 0.25093954, 0.2507744 , 0.25063629,       0.25052117, 0.25042553, 0.25034635, 0.25028101, 0.25022728,       0.25018324, 0.25014727, 0.25011798, 0.25009422, 0.250075  ] )
    assert_almost_equal(hf, [0.00000000e+00, 5.15985451e-04, 1.00467357e-03, 1.76334763e-03,       2.85103513e-03, 4.31451299e-03, 6.18485134e-03, 8.47615626e-03,       1.11861245e-02, 1.42978796e-02, 1.77825601e-02, 2.16022125e-02,       2.57126557e-02, 3.00660926e-02, 3.46133487e-02, 3.93056838e-02,       4.40961820e-02, 4.89407524e-02, 5.37987936e-02, 5.86335793e-02,       6.34124241e-02, 6.81066804e-02, 7.26916141e-02, 7.71461958e-02,       8.14528389e-02, 8.55971076e-02, 8.95674142e-02, 9.33547166e-02,       9.69522268e-02, 1.00355136e-01, 1.03560359e-01, 1.06566302e-01,       1.09372651e-01, 1.11980181e-01, 1.14390595e-01, 1.16606367e-01,       1.18630621e-01, 1.20467015e-01, 1.22119642e-01, 1.23592948e-01,       1.24891659e-01, 1.26020718e-01, 1.26985236e-01, 1.27790443e-01,       1.28441653e-01, 1.28944232e-01, 1.29303570e-01, 1.29525061e-01,       1.29614084e-01, 1.29575985e-01, 1.29416068e-01, 1.29139583e-01,       1.28751717e-01, 1.28257589e-01, 1.27662242e-01, 1.26970638e-01,       1.26187658e-01, 1.25318093e-01, 1.24366648e-01, 1.23337932e-01,       1.22236465e-01, 1.21066667e-01, 1.19832864e-01, 1.18539285e-01,       1.17190055e-01, 1.15789204e-01, 1.14340655e-01, 1.12848234e-01,       1.11315659e-01, 1.09746546e-01, 1.08144405e-01, 1.06512640e-01,       1.04854548e-01, 1.03173320e-01, 1.01472038e-01, 9.97536764e-02,       9.80211005e-02, 9.62770676e-02, 9.45242261e-02, 9.27651158e-02,       9.10021683e-02, 8.92377073e-02, 8.74739494e-02, 8.57130045e-02,       8.39568771e-02, 8.22074672e-02, 8.04665716e-02, 7.87358853e-02,       7.70170030e-02, 7.53114213e-02, 7.36205400e-02, 7.19456642e-02,       7.02880070e-02, 6.86486911e-02, 6.70287516e-02, 6.54291384e-02,       6.38507186e-02, 6.22942794e-02, 6.07605307e-02, 5.92501080e-02,       5.77635749e-02, 5.63014264e-02, 5.48640913e-02, 5.34519357e-02,       5.20652651e-02, 5.07043279e-02, 4.93693180e-02, 4.80603779e-02,       4.67776009e-02, 4.55210346e-02, 4.42906830e-02, 4.30865095e-02,       4.19084394e-02, 4.07563623e-02, 3.96301348e-02, 3.85295827e-02,       3.74545033e-02, 3.64046678e-02, 3.53798231e-02, 3.43796943e-02,       3.34039863e-02, 3.24523859e-02, 3.15245635e-02, 3.06201750e-02,       2.97388631e-02, 2.88802592e-02, 2.80439847e-02, 2.72296525e-02,       2.64368682e-02, 2.56652312e-02, 2.49143363e-02, 2.41837743e-02,       2.34731335e-02, 2.27820002e-02, 2.21099598e-02, 2.14565976e-02,       2.08214996e-02, 2.02042531e-02, 1.96044476e-02, 1.90216748e-02,       1.84555300e-02, 1.79056118e-02, 1.73715230e-02, 1.68528709e-02,       1.63492677e-02, 1.58603306e-02, 1.53856825e-02, 1.49249518e-02,       1.44777731e-02, 1.40437869e-02, 1.36226401e-02, 1.32139860e-02,       1.28174847e-02, 1.24328026e-02, 1.20596131e-02, 1.16975963e-02,       1.13464389e-02, 1.10058349e-02, 1.06754846e-02, 1.03550955e-02,       1.00443818e-02, 9.74306433e-03, 9.45087084e-03, 9.16753560e-03,       8.89279952e-03, 8.62641003e-03, 8.36812100e-03, 8.11769265e-03,       7.87489149e-03, 7.63949017e-03, 7.41126744e-03, 7.19000801e-03,       6.97550244e-03, 6.76754705e-03, 6.56594380e-03, 6.56594380e-03,       5.58690849e-03, 4.73536146e-03, 3.99820868e-03, 3.36302893e-03,       2.81818239e-03, 2.35288048e-03, 1.95722273e-03, 1.62220609e-03,       1.33971201e-03, 1.10247650e-03, 9.04047283e-04, 7.38732212e-04,       6.01542071e-04, 4.88130519e-04, 3.94733348e-04, 3.18108740e-04,       2.55479778e-04, 2.04480128e-04, 1.63103471e-04, 1.29657046e-04,       1.02719449e-04, 8.11026920e-05, 6.38183983e-05, 5.00479470e-05])
